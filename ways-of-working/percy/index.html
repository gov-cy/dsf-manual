<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<title data-react-helmet="true">Percy Visual Testing | Digital Services Factory Manual 😎</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://gov-cy.github.io/dsf-manual/ways-of-working/percy"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Percy Visual Testing | Digital Services Factory Manual 😎"><meta data-react-helmet="true" name="description" content="Intruduction"><meta data-react-helmet="true" property="og:description" content="Intruduction"><link data-react-helmet="true" rel="icon" href="/dsf-manual/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://gov-cy.github.io/dsf-manual/ways-of-working/percy"><link data-react-helmet="true" rel="alternate" href="https://gov-cy.github.io/dsf-manual/ways-of-working/percy" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://gov-cy.github.io/dsf-manual/ways-of-working/percy" hreflang="x-default"><link rel="stylesheet" href="/dsf-manual/assets/css/styles.1c3e8c79.css">
<link rel="preload" href="/dsf-manual/assets/js/runtime~main.b524a589.js" as="script">
<link rel="preload" href="/dsf-manual/assets/js/main.84897b2e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/dsf-manual/"><div class="navbar__logo"><img src="/dsf-manual/img/logo.svg" alt="Site Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/dsf-manual/img/logo.svg" alt="Site Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">DSF Manual</b></a><a class="navbar__item navbar__link navbar__link--active" href="/dsf-manual/">Tutorial</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/gov-cy/dsf-manual" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/dsf-manual/">Digital Services Factory Team Manual</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/dsf-manual/tech-team-principles">DSF Principles</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/dsf-manual/kubernetes">Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/dsf-manual/devops">Devops practices</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/dsf-manual/govcy-design-system/css-utilities">Govcy Design System</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/dsf-manual/ways-of-working/code-review">Ways of Working</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dsf-manual/ways-of-working/code-review">Code Review</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dsf-manual/ways-of-working/git-flow">Team&#x27;s flow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/dsf-manual/ways-of-working/percy">Percy Visual Testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dsf-manual/ways-of-working/developerworkflow">End-to-end developer workflow</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/dsf-manual/services/child-birth-grant">Services</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Percy Visual Testing</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="intruduction">Intruduction<a class="hash-link" href="#intruduction" title="Direct link to heading">​</a></h2><p>This document describes how you can setup a Percy project, connect it with a GitHub repository and how to use it from the command line or as part of the review builds.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="prerequisites">Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">​</a></h2><ul><li>Access to <a href="https://github.com/gov-cy" target="_blank" rel="noopener noreferrer">gov-cy</a> organization settings on Github </li><li><a href="https://github.com/apps/percy" target="_blank" rel="noopener noreferrer">Percy Github App</a> installed for the <code>gov-cy</code> organization </li><li>Access to <a href="https://percy.io/" target="_blank" rel="noopener noreferrer">Percy</a></li><li>nmp package <a href="https://docs.percy.io/docs/percyscript" target="_blank" rel="noopener noreferrer">@percy/script</a> is installed</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="steps-to-set-it-up">Steps to set it up<a class="hash-link" href="#steps-to-set-it-up" title="Direct link to heading">​</a></h2><ol><li><p>Give permissions on Percy Github App to access the desired repository</p><ul><li>Go to <a href="https://github.com/organizations/gov-cy/settings/installations" target="_blank" rel="noopener noreferrer">https://github.com/organizations/gov-cy/settings/installations</a> and click <code>Configure</code> for the Percy App</li><li>Under the <code>Repository Access</code> Click on <code>Select repositories</code> and select the desired repository.</li><li>Click <code>Save</code></li></ul><p><img alt="Github permissions" src="/dsf-manual/assets/images/percy1-a22a53c49dbb33c3140abe075ed9e0ec.png"></p></li><li><p>Create new project in Percy</p><ul><li>Go to Percy&#x27;s organization page (<a href="https://percy.io/a0d81626" target="_blank" rel="noopener noreferrer">https://percy.io/a0d81626</a>)</li><li>Click <code>Create new project</code></li><li>Complete the <code>Project name</code> and <code>Link a repository</code> (see image below)</li><li>Click <code>Create Project</code></li></ul><p><img alt="Percy create new project" src="/dsf-manual/assets/images/percy2-4b033b38f466d441831dfe4207937690.png"></p></li><li><p>Set PERCY_TOKEN in repository secret</p><ul><li>From the Percy project page copy the <code>PERCY_TOKEN</code> value.</li></ul><p><img alt="PERCY_TOKEN on percy page" src="/dsf-manual/assets/images/percy3-ffbc0701dd408b845259632e8e22483e.png"></p><ul><li>Go to repository&#x27;s settings page in Github, click on <code>Secrets</code> (i.e. <a href="https://github.com/gov-cy/dsf-design-system/settings/secrets/actions" target="_blank" rel="noopener noreferrer">https://github.com/gov-cy/dsf-design-system/settings/secrets/actions</a> URL is different depending on repository)</li><li>Click <code>New repository secret</code> and enter under <em>Name</em> <code>PERCY_TOKEN</code> and under <em>Value</em> paste the token value.</li></ul><p><img alt="Repository secret" src="/dsf-manual/assets/images/percy4-52377557f48e8dd8677ec66307b3d97c.png"></p></li><li><p>Create npm test script </p><ul><li><p>In this step you will need to create a test script that will be used to generate the screenshots and add them to Percy. Depending on the technology used (such as Ember, Cypress, Capybara, Storybook e.t.c) Percy has <em>how to</em> tutorials at <a href="https://docs.percy.io/docs/example-apps" target="_blank" rel="noopener noreferrer">https://docs.percy.io/docs/example-apps</a>. In this tutorial we are using <a href="https://docs.percy.io/docs/percyscript" target="_blank" rel="noopener noreferrer">PercyScript</a> which uses the <code>@percy/script</code> npm package.</p></li><li><p>Create a test script under <code>test\scripts\percy.js</code>. </p><p>Use the <code>page.goto(URL)</code> and <code>percySnapshot(snapshotName, [options])</code> methods to navidate to a page and take snapshots. </p><p>See below a sample test script.</p></li></ul></li></ol><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">PercyScript</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;@percy/script&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> httpServer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;http-server&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PORT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">PORT_NUMBER</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">TEST_URL</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">http://localhost:</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation constant" style="color:#36acaa">PORT</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">/build</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// A script to navigate our app and take snapshots with Percy.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">PercyScript</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">page</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> percySnapshot</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> server </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> httpServer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">listen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">PORT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Server started at </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation constant" style="color:#36acaa">TEST_URL</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Take snapshoots on TEST_URL page</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> page</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">goto</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">TEST_URL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">percySnapshot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;index&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> widths</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">375</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">767</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1280</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Take snapshoots of another page</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> page</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">goto</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">TEST_URL</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/my-cool-new-page&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">percySnapshot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Cool New Page&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> widths</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">375</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">767</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1280</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="5"><li>Create npm script to run test<ul><li>Add the following in your <code>package.json</code> file under <code>scripts</code></li></ul></li></ol><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">&quot;test-percy&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;percy exec -- node tests/scripts/percy.js&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="6"><li><p>Test your script from the <code>command line</code></p><ul><li>You first need to set the enviromental variable <code>PERCY_TOKEN</code>. For example on Windows <code>set PERCY_TOKEN=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</code></li><li>Then simply run <code>npm run test-percy</code></li><li>If all goes well a link will appear in the command line where you can view the screenshoots.</li></ul></li><li><p>Create a github workflow </p><ul><li>Create a workflow file under <code>.github/workflows/percy.yml</code>. See below a sample workflow which fires on pull requests and push on main branch.</li></ul></li></ol><div class="codeBlockContainer_J+bg language-yml theme-code-block"><div class="codeBlockContent_csEI yml"><pre tabindex="0" class="prism-code language-yml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Percy CI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Trigger the workflow on push or pull request,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># but only for the main branch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">push</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token key atrule" style="color:#00a4db">branches</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">pull_request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">branches</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Checkout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> npm install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Percy Test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> percy/exec</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">action@master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;node tests/scripts/percy.js&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">PERCY_TOKEN</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.PERCY_TOKEN </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="run-percy-from-command-line">Run percy from command line<a class="hash-link" href="#run-percy-from-command-line" title="Direct link to heading">​</a></h2><p>From the <code>command line</code></p><ul><li>You first need to set the enviromental variable <code>PERCY_TOKEN</code>. For example on Windows <code>set PERCY_TOKEN=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</code></li><li>Then simply run <code>npm run test-percy</code></li><li>If all goes well a link will appear in the command line where you can view the screenshoots. </li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="github-review-builds">Github review builds<a class="hash-link" href="#github-review-builds" title="Direct link to heading">​</a></h2><p>Once you&#x27;ve added the app and linked projects with repositories, subsequent Percy builds will show metadata from GitHub and Percy will automatically update the pull request summary if there are visual differences waiting for review.</p><p><img alt="Github pull request review" src="/dsf-manual/assets/images/percy6-4b9a846ff601405886f5df88bafadfd6.png"></p><p><em>Note: By default, Percy approvals aren’t required before merging, but you can enable this feature once you’re ready for it.</em></p><p>Clicking &quot;Details&quot; will take you directly to the Percy build UI showing all visual diffs to be reviewed. </p><p><img alt="Percy snapshoots page" src="/dsf-manual/assets/images/percy5-6f355397f427faec16551bab1f2edcde.png"></p><p>Approving a build in Percy sets the Percy status in GitHub to green/successful, so that your team can see that any visual changes were reviewed and approved.</p><p><img alt="Github pull request review" src="/dsf-manual/assets/images/percy7-c8f3047aab9f5d07af9bd7a6acf51187.png"></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="adding-comments">Adding comments<a class="hash-link" href="#adding-comments" title="Direct link to heading">​</a></h3><p>To add a comment and start a comment thread, select the icon in the snapshot header.</p><p><img alt="Percy comments" src="/dsf-manual/assets/images/percy12-e9a225ac9218dab80d11d7a925620d5b.png"></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="changes-requested-workflow">Changes requested workflow<a class="hash-link" href="#changes-requested-workflow" title="Direct link to heading">​</a></h3><p>In addition to approving snapshots with visual changes, you can also “request changes.” </p><p><img alt="Percy request for change" src="/dsf-manual/assets/images/percy8-0eb86c791c7cebd520a6f6132af002a5.png"></p><p><img alt="Percy builds request for change" src="/dsf-manual/assets/images/percy9-b94a81b6425d73ec2c33fc49f959e8c9.png"></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="percy-features">Percy features<a class="hash-link" href="#percy-features" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="cross-browser-visual-testing">Cross-browser visual testing<a class="hash-link" href="#cross-browser-visual-testing" title="Direct link to heading">​</a></h3><p>Cross-browser visual testing is available for all Percy customers to effortlessly see visual changes across different browsers.</p><p>Percy currently supports modern Chrome, Firefox, Edge and Safari browsers, with support for more browsers in the works. Browser upgrades are handled automatically.</p><p><img alt="Percy cross-browser visual testing" src="/dsf-manual/assets/images/percy10-90197f389287b4ba9150768ded9c3770.gif"></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="responsive-visual-testing">Responsive visual testing<a class="hash-link" href="#responsive-visual-testing" title="Direct link to heading">​</a></h3><p>You can perform visual testing for responsive user interfaces, allowing you to automatically detect visual regressions on mobile, tablet, and desktop screens at once.</p><p><img alt="Percy responsive visual testing" src="/dsf-manual/assets/images/percy11-ab4c662b04c67495607b9c133853481f.gif"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/gov-cy/dsf-manual/tree/main/src/docs/Ways of Working/percy.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/dsf-manual/ways-of-working/git-flow"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Team&#x27;s flow</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/dsf-manual/ways-of-working/developerworkflow"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">End-to-end developer workflow</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#intruduction" class="table-of-contents__link toc-highlight">Intruduction</a></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#steps-to-set-it-up" class="table-of-contents__link toc-highlight">Steps to set it up</a></li><li><a href="#run-percy-from-command-line" class="table-of-contents__link toc-highlight">Run percy from command line</a></li><li><a href="#github-review-builds" class="table-of-contents__link toc-highlight">Github review builds</a><ul><li><a href="#adding-comments" class="table-of-contents__link toc-highlight">Adding comments</a></li><li><a href="#changes-requested-workflow" class="table-of-contents__link toc-highlight">Changes requested workflow</a></li></ul></li><li><a href="#percy-features" class="table-of-contents__link toc-highlight">Percy features</a><ul><li><a href="#cross-browser-visual-testing" class="table-of-contents__link toc-highlight">Cross-browser visual testing</a></li><li><a href="#responsive-visual-testing" class="table-of-contents__link toc-highlight">Responsive visual testing</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/dsf-manual/">Home</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/gov-cy" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GOV.CY GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2022 Digital Services Factory Team - Republic of Cyprus.</div></div></div></footer></div>
<script src="/dsf-manual/assets/js/runtime~main.b524a589.js"></script>
<script src="/dsf-manual/assets/js/main.84897b2e.js"></script>
</body>
</html>